   Compiling core-rs v1.1.0 (/app/packages/core-rs)
warning: unused import: `chrono::TimeZone`
 --> packages/core-rs/src/task/db.rs:4:5
  |
4 | use chrono::TimeZone;
  |     ^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: unused variable: `large_estimate`
   --> packages/core-rs/src/llm/cost.rs:457:13
    |
457 |         let large_estimate = tracker.estimate_cost("gpt-4", 100000, 50000);
    |             ^^^^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_large_estimate`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: variable does not need to be mutable
   --> packages/core-rs/src/sync/conflict_resolver.rs:331:13
    |
331 |         let mut local = create_entity("entity1", "device1", 100);
    |             ----^^^^^
    |             |
    |             help: remove this `mut`
    |
    = note: `#[warn(unused_mut)]` (part of `#[warn(unused)]`) on by default

warning: `core-rs` (lib test) generated 3 warnings (1 duplicate) (run `cargo fix --lib -p core-rs --tests` to apply 1 suggestion)
warning: `core-rs` (lib) generated 1 warning
    Finished `test` profile [unoptimized + debuginfo] target(s) in 42.28s
     Running unittests src/lib.rs (/app/target/debug/deps/core_rs-155839ff208e0aa8)

running 196 tests
test ai::rag::tests::test_chunk_document ... ok
test ai::rag::tests::test_calculate_confidence ... ok
test ai::rag::tests::test_chunk_short_document ... ok
test ai::rag::tests::test_chunk_empty_document ... ok
test ai::rag::tests::test_initialize_vector_store ... ok
test ai::rag::tests::test_get_stats_empty ... ok
test ai::rag::tests::test_prepare_fts_query_special_chars ... ok
test ai::rag::tests::test_prepare_fts_query ... ok
test auth::tests::test_authentication_failure_nonexistent_user ... ok
test auth::tests::test_authentication_success ... ok
test auth::tests::test_authentication_failure_invalid_password ... ok
test auth::tests::test_duplicate_username_rejected ... ok
test auth::tests::test_get_user ... ok
test auth::tests::test_logout ... ok
test auth::tests::test_session_expiration ... ok
test auth::tests::test_weak_password_rejected ... ok
test correlation::detectors::calendar_projects::tests::test_detects_conflict_many_events ... FAILED
test correlation::detectors::calendar_projects::tests::test_no_conflict_few_events ... ok
test correlation::detectors::health_workload::tests::test_detects_overwork_low_mood ... ok
test correlation::detectors::health_workload::tests::test_no_correlation_healthy_balance ... ok
test correlation::detectors::health_workload::tests::test_no_correlation_insufficient_data ... ok
test correlation::detectors::time_productivity::tests::test_detects_mismatch ... ok
test correlation::detectors::time_productivity::tests::test_no_mismatch_low_time ... ok
test correlation::detectors::time_productivity::tests::test_no_mismatch_proportional ... ok
test correlation::tests::test_config_defaults ... ok
test correlation::tests::test_engine_creation ... ok
test correlation::types::tests::test_correlation_strength_clamping ... ok
test correlation::types::tests::test_correlation_types ... ok
test db::materialized_views::tests::test_get_dashboard_stats_empty ... ok
test db::materialized_views::tests::test_init_materialized_views ... ok
test db::materialized_views::tests::test_note_delete_trigger ... ok
test db::materialized_views::tests::test_note_insert_trigger ... ok
test db::materialized_views::tests::test_refresh_all ... ok
test db::materialized_views::tests::test_refresh_dashboard_stats ... ok
test db::pragma_tuning::tests::test_apply_config ... ok
test db::pragma_tuning::tests::test_auto_detect ... ok
test db::pragma_tuning::tests::test_default_config ... ok
test db::pragma_tuning::tests::test_detect_profile ... ok
test db::pragma_tuning::tests::test_get_current ... FAILED
test db::pragma_tuning::tests::test_get_stats ... ok
test db::pragma_tuning::tests::test_optimize ... ok
test db::pragma_tuning::tests::test_profile_configs ... ok
test db::vault_backup::tests::test_recover_from_backup ... ok
test db::vault_backup::tests::test_store_and_retrieve_backup ... ok
test db::vault_backup::tests::test_verify_backup ... ok
test llm::batch::tests::test_batch_builder ... ok
test llm::batch::tests::test_batch_builder_from_prompts ... ok
test llm::batch::tests::test_batch_config_defaults ... ok
test llm::batch::tests::test_batch_processor_mock ... ok
test llm::batch::tests::test_batch_progress ... ok
test llm::config::tests::test_cloud_first ... ok
test llm::config::tests::test_default_config ... ok
test llm::config::tests::test_privacy_first ... ok
test llm::cost::tests::test_budget_checking ... ok
test llm::cost::tests::test_cost_stats ... ok
test llm::cost::tests::test_cost_tracker ... ok
test llm::cost::tests::test_model_pricing ... ok
test llm::cost::tests::test_pricing_calculation ... ok
test llm::cost::tests::test_provider_comparison ... ok
test llm::error::tests::test_error_client ... ok
test llm::error::tests::test_error_retryable ... ok
test llm::error::tests::test_error_server ... ok
test llm::error::tests::test_transient_detection ... ok
test llm::priority::tests::test_async_queue ... ok
test llm::priority::tests::test_deadline_priority ... ok
test llm::priority::tests::test_enqueue_dequeue ... ok
test llm::priority::tests::test_fifo_within_priority ... ok
test llm::priority::tests::test_priority_ordering ... ok
test llm::priority::tests::test_queue_full ... ok
test llm::priority::tests::test_queue_stats ... ok
test llm::priority::tests::test_request_age ... ok
test llm::retry::tests::test_circuit_breaker_closed ... ok
test llm::retry::tests::test_circuit_breaker_open ... ok
test llm::retry::tests::test_delay_calculation ... ok
test llm::retry::tests::test_is_retryable ... ok
test llm::retry::tests::test_retry_config_defaults ... ok
test llm::retry::tests::test_with_retry_eventual_success ... ok
test llm::retry::tests::test_with_retry_success ... ok
test llm::streaming::tests::test_stream_chunk_creation ... ok
test llm::streaming::tests::test_stream_chunk_final ... ok
test llm::streaming::tests::test_stream_collector ... ok
test llm::streaming::tests::test_stream_handler ... ok
test llm::streaming::tests::test_stream_request_builder ... ok
test llm::tests::test_client_creation ... ok
test llm::tokenizer::tests::test_model_limits ... ok
test llm::tokenizer::tests::test_request_counting ... ok
test llm::tokenizer::tests::test_simple_counter ... ok
test llm::tokenizer::tests::test_token_count_within_limit ... ok
test llm::tokenizer::tests::test_truncate_to_fit ... ok
test llm::tokenizer::tests::test_word_based_counter ... ok
test llm::types::tests::test_cache_key_consistency ... ok
test llm::types::tests::test_cache_key_deterministic ... ok
test llm::types::tests::test_cache_key_different ... ok
test llm::types::tests::test_cache_key_includes_max_tokens ... ok
test llm::types::tests::test_cache_key_includes_model ... ok
test llm::types::tests::test_cache_key_includes_stop_sequences ... ok
test llm::types::tests::test_cache_key_includes_temperature ... ok
test llm::types::tests::test_cache_key_includes_top_p ... ok
test llm::types::tests::test_cache_key_message_order_matters ... ok
test llm::types::tests::test_cache_key_multiple_parameters ... ok
test llm::types::tests::test_cache_key_none_vs_some ... ok
test llm::types::tests::test_message_all_roles ... ok
test llm::types::tests::test_message_creation ... ok
test llm::types::tests::test_message_empty_content ... ok
test llm::types::tests::test_message_string_conversions ... ok
test llm::types::tests::test_request_builder ... ok
test llm::types::tests::test_request_builder_chain_order ... ok
test llm::types::tests::test_request_builder_overwrite ... ok
test llm::types::tests::test_request_simple ... ok
test llm::types::tests::test_request_with_system ... ok
test llm::types::tests::test_response_creation ... ok
test llm::types::tests::test_response_empty_content ... ok
test llm::types::tests::test_response_string_conversions ... ok
test llm::types::tests::test_role_equality ... ok
test llm::validation::tests::test_composite_validator ... ok
test llm::validation::tests::test_content_filter ... ok
test llm::validation::tests::test_json_validator_failure ... ok
test llm::validation::tests::test_json_validator_success ... ok
test llm::validation::tests::test_json_validator_with_markdown ... ok
test llm::validation::tests::test_length_validator ... ok
test logger::tests::test_log_levels ... ok
test logger::tests::test_logger_creation ... ok
test logger::tests::test_logger_file_output ... ok
test social::account::tests::test_add_and_get_account ... ok
test social::backup::tests::test_backup_metadata_structure ... ok
test social::backup::tests::test_backup_service_creation ... ok
test social::backup::tests::test_list_backups_empty ... ok
test social::category::tests::test_assign_and_get_post_categories ... ok
test auth::tests::test_session_validation ... ok
test social::category::tests::test_assign_category_idempotent ... ok
test social::category::tests::test_auto_categorize_by_keyword ... ok
test social::category::tests::test_auto_categorize_by_platform ... ok
test auth::tests::test_user_registration ... ok
test auth::tests::test_change_password ... ok
test social::category::tests::test_auto_categorize_keyword_with_special_chars ... ok
test social::category::tests::test_auto_categorize_no_duplicate_assignments ... ok
test social::category::tests::test_create_and_get_category ... ok
test social::category::tests::test_create_category_with_filters ... ok
test social::category::tests::test_delete_category ... ok
test social::category::tests::test_get_all_categories ... ok
test social::intelligence::tests::test_analyze_post_content ... ok
test social::intelligence::tests::test_analyze_post_content_complex ... ok
test social::intelligence::tests::test_analyze_post_content_empty ... ok
test social::intelligence::tests::test_sentiment_detection ... ok
test social::intelligence::tests::test_sentiment_edge_cases ... ok
test social::intelligence::tests::test_sentiment_neutral_content ... ok
test social::intelligence::tests::test_summary_different_terminators ... ok
test social::intelligence::tests::test_summary_edge_cases ... ok
test social::intelligence::tests::test_summary_generation ... ok
test social::intelligence::tests::test_summary_truncation ... ok
test social::intelligence::tests::test_topic_extraction ... ok
test social::intelligence::tests::test_topic_extraction_all_categories ... ok
test social::intelligence::tests::test_topic_extraction_edge_cases ... ok
test social::intelligence::tests::test_topic_extraction_multiple_topics ... ok
test social::maintenance::tests::test_prune_old_posts ... ok
test social::maintenance::tests::test_startup_maintenance ... ok
test social::selector_verification::tests::test_bundled_selectors_exist ... ok
test social::selector_verification::tests::test_compute_hash ... ok
test social::selector_verification::tests::test_parse_plain_json ... ok
test social::category::tests::test_get_category_not_found ... ok
test social::stream_processor::tests::test_ingest_basic ... ok
test social::stream_processor::tests::test_metric_parsing ... FAILED
test social::stream_processor::tests::test_new_processor ... ok
test social::stream_processor::tests::test_reddit_extraction ... FAILED
test social::category::tests::test_update_category ... ok
test social::stream_processor::tests::test_twitter_extraction ... FAILED
test sync::conflict_resolver::tests::test_array_merge_deduplication ... ok
test sync::conflict_resolver::tests::test_array_merge_set_union ... FAILED
test sync::conflict_resolver::tests::test_device_priority ... FAILED
test sync::conflict_resolver::tests::test_last_write_wins ... FAILED
test social::category::tests::test_remove_category ... ok
test sync::conflict_resolver::tests::test_merge_strategy ... FAILED
test sync::mobile_sync::tests::test_batch_processor ... ok
test sync::mobile_sync::tests::test_device_pairing ... ok
test sync::mobile_sync::tests::test_device_pairing_with_wrong_code ... ok
test sync::mobile_sync::tests::test_remove_paired_device ... ok
test sync::mobile_sync::tests::test_sync_protocol_creation ... ok
test sync::mobile_sync::tests::test_sync_state_transitions ... ok
test sync::relay::tests::test_envelope_creation ... ok
test sync::relay::tests::test_relay_server_basic ... ok
test sync::relay::tests::test_stats ... ok
test sync::tofu::tests::test_explicit_verification ... ok
test sync::tofu::tests::test_first_use_trust ... ok
test sync::relay::tests::test_message_size_limit ... ok
test sync::tofu::tests::test_key_change_detection ... ok
test sync::tofu::tests::test_revoke_trust ... ok
test sync::tofu::tests::test_trust_level_allows_sync ... ok
test sync::vector_clock::tests::test_concurrent_clocks ... ok
test sync::vector_clock::tests::test_happens_before ... ok
test sync::tofu::tests::test_same_key_verification ... ok
test sync::vector_clock::tests::test_vector_clock_increment ... ok
test sync::vector_clock::tests::test_vector_clock_merge ... ok
test temporal_graph::tests::test_community_detection ... ok
test tests::it_works ... ok
test social::stream_processor::tests::test_reset ... ok
test social::stream_processor::tests::test_deduplication ... FAILED

failures:

---- correlation::detectors::calendar_projects::tests::test_detects_conflict_many_events stdout ----

thread 'correlation::detectors::calendar_projects::tests::test_detects_conflict_many_events' (90653) panicked at packages/core-rs/src/correlation/detectors/calendar_projects.rs:133:9:
assertion failed: result.is_some()
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

---- db::pragma_tuning::tests::test_get_current stdout ----

thread 'db::pragma_tuning::tests::test_get_current' (90675) panicked at packages/core-rs/src/db/pragma_tuning.rs:383:9:
assertion failed: config.is_ok()

---- social::stream_processor::tests::test_metric_parsing stdout ----

thread 'social::stream_processor::tests::test_metric_parsing' (90798) panicked at packages/core-rs/src/social/stream_processor.rs:1150:9:
assertion `left == right` failed
  left: 25000000
 right: 2500000

---- social::stream_processor::tests::test_reddit_extraction stdout ----

thread 'social::stream_processor::tests::test_reddit_extraction' (90800) panicked at packages/core-rs/src/social/stream_processor.rs:594:45:
range end index 5 out of range for slice of length 4

---- social::stream_processor::tests::test_twitter_extraction stdout ----

thread 'social::stream_processor::tests::test_twitter_extraction' (90802) panicked at packages/core-rs/src/social/stream_processor.rs:1096:9:
assertion failed: candidate.is_some()

---- sync::conflict_resolver::tests::test_array_merge_set_union stdout ----

thread 'sync::conflict_resolver::tests::test_array_merge_set_union' (90804) panicked at packages/core-rs/src/sync/conflict_resolver.rs:409:18:
Expected resolved conflict but got: NoConflict

---- sync::conflict_resolver::tests::test_device_priority stdout ----

thread 'sync::conflict_resolver::tests::test_device_priority' (90805) panicked at packages/core-rs/src/sync/conflict_resolver.rs:360:18:
Expected resolved conflict but got: NoConflict

---- sync::conflict_resolver::tests::test_last_write_wins stdout ----

thread 'sync::conflict_resolver::tests::test_last_write_wins' (90806) panicked at packages/core-rs/src/sync/conflict_resolver.rs:341:18:
Expected resolved conflict but got: NoConflict

---- sync::conflict_resolver::tests::test_merge_strategy stdout ----

thread 'sync::conflict_resolver::tests::test_merge_strategy' (90807) panicked at packages/core-rs/src/sync/conflict_resolver.rs:380:18:
Expected resolved conflict but got: NoConflict

---- social::stream_processor::tests::test_deduplication stdout ----

thread 'social::stream_processor::tests::test_deduplication' (90796) panicked at packages/core-rs/src/social/stream_processor.rs:695:45:
range end index 7 out of range for slice of length 6


failures:
    correlation::detectors::calendar_projects::tests::test_detects_conflict_many_events
    db::pragma_tuning::tests::test_get_current
    social::stream_processor::tests::test_deduplication
    social::stream_processor::tests::test_metric_parsing
    social::stream_processor::tests::test_reddit_extraction
    social::stream_processor::tests::test_twitter_extraction
    sync::conflict_resolver::tests::test_array_merge_set_union
    sync::conflict_resolver::tests::test_device_priority
    sync::conflict_resolver::tests::test_last_write_wins
    sync::conflict_resolver::tests::test_merge_strategy

test result: FAILED. 186 passed; 10 failed; 0 ignored; 0 measured; 0 filtered out; finished in 3.90s

error: test failed, to rerun pass `--lib`
